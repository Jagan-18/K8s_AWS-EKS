##creating one pipeline project name- 'AWS eks Demo' by using jenkins declarative pipeline

---
pipeline {
    agent any

    stages {
        stage('Check EKS Access') {
            steps {
                withAWS(credentials: 'aws-access-creds'){
                sh 'aws eks update-kubeconfig  --region us-east-1 --name k8sb20'
                sh 'kubectl get pods -A'
                }
            }
        }
        stage('Creating EKS Namespaces') {
            steps {
                withAWS(credentials: 'aws-access-creds'){
                sh 'aws eks update-kubeconfig  --region us-east-1 --name k8sb20'
                sh 'kubectl create ns developement || exit 0'
                sh 'kubectl create ns Production || exit 0'
                }
            }
        }
        stage('Deploy To Dev Namespace ') {
              when {
                 branch 'development'
              }
            steps {
               withAWS(credentials: 'aws-access-creds'){
                sh 'aws eks update-kubeconfig  --region us-east-1 --name k8sb20'
                sh 'ls -al'
                sh 'kustomize build kustomize/overlays/development'
               }
            }
        }
    }
}
